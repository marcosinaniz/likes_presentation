<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cost of a Like ‚Äî Demo</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #0f0f12;
      color: #eaeaea;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .wrap {
      height: 100%;
      display: grid;
      place-items: center;
      text-align: center;
      gap: 1rem;
      padding: 2rem;
    }
    h1 { font-weight: 700; margin: 0; font-size: clamp(1.3rem, 2.5vw, 1.8rem); opacity: .9; }
    .heart-btn {
      width: clamp(160px, 30vmin, 260px);
      height: clamp(160px, 30vmin, 260px);
      border-radius: 999px;
      border: none;
      outline: none;
      cursor: pointer;
      background: radial-gradient(circle at 30% 30%, #ff6b6b, #d90429);
      box-shadow: 0 10px 30px rgba(217,4,41,.35), inset 0 0 40px rgba(255,255,255,.15);
      position: relative;
      transition: transform .08s ease;
    }
    .heart-btn:disabled { opacity: .4; cursor: not-allowed; }
    .heart-btn:active { transform: scale(.98); }
    .heart {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 45%;
      height: auto;
      transform: translate(-50%, -50%);
      fill: #ff2e63; /* ‚ù§Ô∏è bright red heart */
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.25));
      pointer-events: none;
    }
    .counter {
      font-size: clamp(1.1rem, 2.2vw, 1.5rem);
      opacity: .8;
    }
    .particle {
      position: fixed;
      font-size: 18px;
      pointer-events: none;
      animation: floatUp 900ms ease forwards;
      opacity: .9;
      text-shadow: 0 2px 8px rgba(0,0,0,.45);
    }
    @keyframes floatUp {
      from { transform: translateY(0) scale(1); opacity: 1; }
      to   { transform: translateY(-120px) scale(1.4); opacity: 0; }
    }
    .footer { position: fixed; bottom: 10px; width: 100%; text-align: center; font-size: .9rem; opacity: .6; }
    a { color: #9be1ff; text-decoration: none; }
    .name-box input { padding: .5rem; font-size: 1rem; border-radius: 6px; border: none; }
    .name-box button { padding: .5rem .75rem; margin-left: .5rem; font-size: 1rem; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Tap the heart. Watch your number climb.</h1>
    <div class="name-box">
      <input id="nameInput" type="text" placeholder="Your name" />
      <button id="saveNameBtn">Save</button>
    </div>
    <button id="heartBtn" class="heart-btn" aria-label="Like">
      <svg class="heart" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
                 2 6.01 4.01 4 6.5 4c1.74 0 3.41.81 4.5 2.09
                 C12.59 4.81 14.26 4 16 4 18.49 4 20.5 6.01 20.5 8.5
                 c0 3.78-3.4 6.86-8.05 11.54L12 21.35z"/>
      </svg>
    </button>
    <div class="counter" id="countLabel">Your likes: <strong id="count">0</strong></div>
  </div>
  <div class="footer">
    Stats (admin): <a href="./admin.html">/admin</a>
  </div>

  <script>
    const btn = document.getElementById('heartBtn');
    const countEl = document.getElementById('count');
    const nameInput = document.getElementById('nameInput');
    const saveBtn = document.getElementById('saveNameBtn');

    function spawnParticle(x, y) {
      const p = document.createElement('div');
      p.className = 'particle';
      p.style.left = x + 'px';
      p.style.top = y + 'px';
      const emojis = ['‚ù§','üíñ','üíó','üíì','‚ú®','üíû','üíò'];
      p.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      document.body.appendChild(p);
      setTimeout(()=>p.remove(), 900);
    }

    function getName() {
      return localStorage.getItem('likeUserName') || '';
    }

    function setName(name) {
      localStorage.setItem('likeUserName', name);
    }

    async function refreshUserCount() {
      const name = getName();
      if (!name) return;
      const res = await fetch(`/api/get-user?name=${encodeURIComponent(name)}`);
      const data = await res.json();
      countEl.textContent = data.count ?? 0;
    }

    btn.addEventListener('click', async () => {
      const name = getName();
      if (!name) return;
      const rect = btn.getBoundingClientRect();
      for (let i=0;i<6;i++) {
        const jitterX = (Math.random() - 0.5) * 120;
        const jitterY = (Math.random() - 0.5) * 40;
        spawnParticle(rect.left + rect.width/2 + jitterX, rect.top + rect.height/2 + jitterY);
      }
      const res = await fetch('/api/increment-user', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      });
      const data = await res.json();
      countEl.textContent = data.count ?? 0;
    });

    saveBtn.addEventListener('click', () => {
      const val = nameInput.value.trim();
      if (!val) return alert('Please enter a name');
      setName(val);
      btn.disabled = false;
      refreshUserCount();
    });

    // initialize
    const storedName = getName();
    if (storedName) {
      nameInput.value = storedName;
      btn.disabled = false;
      refreshUserCount();
    }
  </script>
</body>
</html>
